##### 题目描述：

爱丽丝参与一个大致基于纸牌游戏 “21点” 规则的游戏，描述如下：

爱丽丝以 `0` 分开始，并在她的得分少于 `K` 分时抽取数字。 抽取时，她从 `[1, W]` 的范围中随机获得一个整数作为分数进行累计，其中 `W` 是整数。 每次抽取都是独立的，其结果具有相同的概率。

当爱丽丝获得不少于 `K` 分时，她就停止抽取数字。 爱丽丝的分数不超过 `N` 的概率是多少？

 

**示例** **1****：**

```
输入：N = 10, K = 1, W = 10
输出：1.00000
说明：爱丽丝得到一张卡，然后停止。
```

**示例** **2****：**

```
输入：N = 6, K = 1, W = 10
输出：0.60000
说明：爱丽丝得到一张卡，然后停止。
在 W = 10 的 6 种可能下，她的得分不超过 N = 6 分。
```

**示例** **3****：**

```
输入：N = 21, K = 17, W = 10
输出：0.73278
```





#### 方法一：动态规划

爱丽丝获胜的概率只和下一轮开始前的得分有关，因此根据得分计算概率。

令 dp[x]*d**p*[*x*] 表示从得分为 x*x* 的情况开始游戏并且获胜的概率，目标是求 dp[0]*d**p*[0] 的值。

根据规则，当分数达到或超过 K*K* 时游戏结束，游戏结束时，如果分数不超过 N*N* 则获胜，如果分数超过 N*N* 则失败。因此当 K\leq x\leq \min(N, K+W-1)*K*≤*x*≤min(*N*,*K*+*W*−1) 时有 dp[x]=1*d**p*[*x*]=1，当 x>\min(N, K+W-1)*x*>min(*N*,*K*+*W*−1) 时有 dp[x]=0*d**p*[*x*]=0。

> 为什么分界线是 \min(N, K+W-1)min(*N*,*K*+*W*−1)？首先，只有在分数不超过 N*N* 时才算获胜；其次，可以达到的最大分数为 K+W-1*K*+*W*−1，即在最后一次抽取数字之前的分数为 K-1*K*−1，并且抽到了 W*W*。

当 0\leq x < K0≤*x*<*K* 时，如何计算 dp[x]*d**p*[*x*] 的值？注意到每次在范围 [1, W][1,*W*] 内随机抽取一个整数，且每个整数被抽取到的概率相等，因此可以得到如下状态转移方程：

dp[x]=\frac{dp[x+1]+dp[x+2]+\cdots+dp[x+W]}{W}*d**p*[*x*]=*W**d**p*[*x*+1]+*d**p*[*x*+2]+⋯+*d**p*[*x*+*W*]



上述解法的时间复杂度是 O(N+KW)*O*(*N*+*K**W*)，会超出时间限制，因此需要优化。

考虑对 dp*d**p* 的相邻项计算差分，有如下结果：

dp[x] - dp[x+1]=\frac{dp[x+1] - dp[x+W+1]}{W}*d**p*[*x*]−*d**p*[*x*+1]=*W**d**p*[*x*+1]−*d**p*[*x*+*W*+1]

其中 0\leq x<K-10≤*x*<*K*−1。

因此可以得到新的状态转移方程：

dp[x]=dp[x+1]-\frac{dp[x+W+1]-dp[x+1]}{W}*d**p*[*x*]=*d**p*[*x*+1]−*W**d**p*[*x*+*W*+1]−*d**p*[*x*+1]

其中 0\leq x<K-10≤*x*<*K*−1。

注意到上述状态转移方程中 x*x* 的取值范围，当 x=K-1*x*=*K*−1 时不适用。因此对于 dp[K-1]*d**p*[*K*−1] 的值，需要通过

dp[K-1]=\frac{dp[K]+dp[K+1]+\cdots+dp[K+W-1]}{W}*d**p*[*K*−1]=*W**d**p*[*K*]+*d**p*[*K*+1]+⋯+*d**p*[*K*+*W*−1]

计算得到。注意到只有当 K\leq x\leq \min(N, K+W-1)*K*≤*x*≤min(*N*,*K*+*W*−1) 时才有 dp[x]=1*d**p*[*x*]=1，因此

dp[K-1]=\frac{\min(N, K+W-1) - K + 1}{W} = \frac{\min(N-K+1,W)}{W}*d**p*[*K*−1]=*W*min(*N*,*K*+*W*−1)−*K*+1=*W*min(*N*−*K*+1,*W*)

可在 O(1)*O*(1) 时间内计算得到 dp[K-1]*d**p*[*K*−1] 的值。

对于 dp[K-2]*d**p*[*K*−2] 到 dp[0]*d**p*[0] 的值，则可通过新的状态转移方程得到。